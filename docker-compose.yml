services:
  # SpiffWorkflow Backend API
  spiffworkflow-backend:
    image: ghcr.io/sartography/spiffworkflow-backend:latest
    container_name: spiffworkflow-backend
    environment:
      # Database configuration (using SQLite for simplicity)
      SPIFFWORKFLOW_BACKEND_DATABASE_URI: "sqlite:////app/db_volume/db.sqlite3"

      # Application settings
      SPIFFWORKFLOW_BACKEND_APPLICATION_ROOT: "/"
      SPIFFWORKFLOW_BACKEND_URL: "http://localhost:8000"

      # BPMN spec storage
      SPIFFWORKFLOW_BACKEND_BPMN_SPEC_ABSOLUTE_DIR: "/app/process_models"

      # Connector proxy
      SPIFFWORKFLOW_BACKEND_CONNECTOR_PROXY_URL: "http://spiffworkflow-connector:8004"

      # Logging
      SPIFFWORKFLOW_BACKEND_LOG_LEVEL: "DEBUG"
    ports:
      - "${SPIFF_BACKEND_PORT:-8000}:8000"
    volumes:
      - spiffworkflow_backend_db:/app/db_volume
      - ./process_models:/app/process_models:ro
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/v1.0/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # SpiffWorkflow Frontend UI
  spiffworkflow-frontend:
    image: ghcr.io/sartography/spiffworkflow-frontend:latest
    container_name: spiffworkflow-frontend
    depends_on:
      - spiffworkflow-backend
    environment:
      # Backend API URL
      APPLICATION_ROOT: "/"
      PORT: "8001"
    ports:
      - "${SPIFFWORKFLOW_FRONTEND_PORT:-8001}:8001"

  # Connector proxy for external integrations
  spiffworkflow-connector:
    image: ghcr.io/sartography/connector-proxy-demo:latest
    container_name: spiffworkflow-connector
    environment:
      FLASK_ENV: development
      FLASK_DEBUG: "0"
    ports:
      - "${SPIFF_CONNECTOR_PORT:-8004}:8004"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8004/liveness"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  spiffworkflow_backend_db:
    driver: local
